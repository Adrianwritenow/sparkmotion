name = "sparkmotion-redirect"
main = "src/worker.ts"
compatibility_date = "2024-12-18"
account_id = "efeaec566e12863d8012fe1708d204fb"
# Custom domain route — matches dashboard config
# Production traffic reaches Worker via *.sparkmotion.net/* (wildcard route)
# workers.dev URL also remains active as a direct fallback
routes = [
  { pattern = "*.sparkmotion.net/*", zone_name = "sparkmotion.net" }
]

# KV namespace — replace with actual ID after: wrangler kv namespace create REDIRECT_MAP
[[kv_namespaces]]
binding = "REDIRECT_MAP"
id = "3cddf6ee74324904a34cb1b08a87a0a6"

# Environment variables are set via: wrangler secret put <NAME>
# Required secrets:
#   HUB_URL                    — Vercel Hub origin (e.g. https://geo.sparkmotion.net)
#   UPSTASH_REDIS_REST_URL     — Upstash Redis REST endpoint
#   UPSTASH_REDIS_REST_TOKEN   — Upstash Redis REST token
#   FALLBACK_URL               — Generic fallback URL (e.g. https://sparkmotion.io)

# Staging environment — deploy with: npx wrangler deploy --env staging
[env.staging]
name = "sparkmotion-redirect-staging"
workers_dev = false  # Staging traffic uses custom domain route only

routes = [
  { pattern = "staging-redirect.sparkmotion.net/*", zone_name = "sparkmotion.net" }
]

[[env.staging.kv_namespaces]]
binding = "REDIRECT_MAP"
id = "231dfa0714df43b7a9b7a672f0ce75d4"

# Set staging secrets with:
#   wrangler secret put HUB_URL --env staging
#   wrangler secret put UPSTASH_REDIS_REST_URL --env staging
#   wrangler secret put UPSTASH_REDIS_REST_TOKEN --env staging
#   wrangler secret put FALLBACK_URL --env staging
